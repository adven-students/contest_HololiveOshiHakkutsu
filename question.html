<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Question</title>
  <link href="questionstyle.css" rel="stylesheet">
</head>

<body>
  <div><img class="rabit" src="推し活素材/画像/ファンサうさぎ（桃）.png"></div>
  <div id="contents">
    <div class="block">
      <div class="question-box"><br>Question
        <div class="question" id="系統" style="display: block;">
          <div class="toi">好きな系統は??</div>

          <ul>
            <li>
              <input type="checkbox" id="cute" name="drone" value="かわいい" />
              <label for="cute">かわいい</label>
            </li>

            <li>
              <input type="checkbox" id="cool" name="drone" value="かっこいい" />
              <label for="cool">かっこいい</label>
            </li>

            <li>
              <input type="checkbox" id="beautiful" name="drone" value="きれい" />
              <label for="beautiful">きれい</label>
            </li>

            <li>
              <input type="checkbox" id="mysterious" name="drone" value="ミステリアス" />
              <label for="mysterious">ミステリアス</label>
            </li>


            <li>
              <input type="checkbox" id="cool" name="drone" value="クール" />
              <label for="cool">クール</label>
            </li>

            <li>
              <input type="checkbox" id="boyish" name="drone" value="ボーイッシュ" />
              <label for="boyish">ボーイッシュ</label>
            </li>

            <li>
              <input type="checkbox" id="natural" name="drone" value="天然" />
              <label for="natural">天然</label>
            </li>

            <li>
              <input type="checkbox" id="cheeky" name="drone" value="生意気" />
              <label for="cheeky">生意気</label>
            </li>

            <li>
              <input type="checkbox" id="sexy" name="drone" value="セクシー" />
              <label for="sexy">セクシー</label>
            </li>

            <li>
              <input type="checkbox" id="fine" name="drone" value="元気" />
              <label for="fine">元気</label>
            </li>

            <li>
              <input type="checkbox" id="useless" name="drone" value="ポンコツ" />
              <label for="useless">ポンコツ</label>
            </li>

            <li>
              <input type="checkbox" id="My own pace" name="drone" value="マイペース" />
              <label for="My own pace">マイペース</label>
            </li>

            <li>
              <input type="checkbox" id="tsundere" name="drone" value="ツンデレ" />
              <label for="tsundere">ツンデレ</label>
            </li>

            <li>
              <input type="checkbox" id="funny" name="drone" value="面白い" />
              <label for="funny">面白い</label>
            </li>

          </ul>
        </div>

        <div class="question" id="イメージカラー" style="display:none;">
          <div class="toi">好きな色は??</div>

          <ul>
            <li>
              <input type="checkbox" id="red" name="drone" value="赤" />
              <label for="red">赤</label>
            </li>

            <li>
              <input type="checkbox" id="blue" name="drone" value="青" />
              <label for="blue">青</label>
            </li>

            <li>
              <input type="checkbox" id="yellow" name="drone" value="黄" />
              <label for="yellow">黄</label>
            </li>

            <li>
              <input type="checkbox" id="green" name="drone" value="緑" />
              <label for="green">緑</label>
            </li>

            <li>
              <input type="checkbox" id="lightblue" name="drone" value="水色" />
              <label for="lightblue">水色</label>
            </li>

            <li>
              <input type="checkbox" id="pink" name="drone" value="ピンク" />
              <label for="pink">ピンク</label>
            </li>

            <li>
              <input type="checkbox" id="orange" name="drone" value="オレンジ" />
              <label for="orange">オレンジ</label>
            </li>

            <li>
              <input type="checkbox" id="purple" name="drone" value="紫" />
              <label for="purple">紫</label>
            </li>

            <li>
              <input type="checkbox" id="white" name="drone" value="白" />
              <label for="white">白</label>
            </li>

            <li>
              <input type="checkbox" id="black" name="drone" value="黒" />
              <label for="black">黒</label>
            </li>

            <li>
              <input type="checkbox" id="gray" name="drone" value="グレー" />
              <label for="gray">グレー</label>
            </li>
          </ul>
        </div>

        <div class="question" id="けもみみ" style="display: none;">
          <div class="toi">けもみみや角は??</div>

          <div>
            <input type="checkbox" id="ear" name="drone" value="けもみみあり" />
            <label for="ear">けもみみあり</label>
          </div>

          <div>
            <input type="checkbox" id="noear" name="drone" value="けもみみなし" />
            <label for="noear">けもみみなし</label>
          </div>

          <div>
            <input type="checkbox" id="horn" name="drone" value="角など" />
            <label for="horn">角など</label>
          </div>

          <div>
            <input type="checkbox" id="elf" name="drone" value="ハーフエルフ" />
            <label for="elf">ハーフエルフ</label>
          </div>
        </div>

        <div class="question" id="主に何を見たいか" style="display: none;">
          <div class="toi">何を見たい??</div>

          <ul>
            <li>
              <input type="checkbox" id="talk" name="drone" value="雑談" />
              <label for="talk">雑談</label>
            </li>

            <li>
              <input type="checkbox" id="game" name="drone" value="ゲーム実況" />
              <label for="game">ゲーム実況</label>
            </li>

            <li>
              <input type="checkbox" id="song" name="drone" value="歌ってみた" />
              <label for="song">歌ってみた</label>
            </li>

            <li>
              <input type="checkbox" id="dance" name="drone" value="踊ってみた" />
              <label for="dance">踊ってみた</label>
            </li>

            <li>
              <input type="checkbox" id="ASMR" name="drone" value="ASMR" />
              <label for="ASMR">ASMR</label>
            </li>

            <li>
              <input type="checkbox" id="cooking" name="drone" value="料理" />
              <label for="cooking">料理</label>
            </li>

            <li>
              <input type="checkbox" id="drawing" name="drone" value="お絵描き" />
              <label for="drawing">お絵描き</label>
            </li>
          </ul>
        </div>

        <div class="question" id="配信頻度" style="display:none;">
          <div class="toi">配信頻度は??(2025年9月時点)</div>

          <ul>
            <li>
              <input type="checkbox" id="L" name="drone" value="多い" />
              <label for="L">多い</label>
            </li>

            <li>
              <input type="checkbox" id="M" name="drone" value="普通" />
              <label for="M">普通</label>
            </li>

            <li>
              <input type="checkbox" id="S" name="drone" value="少ない" />
              <label for="S">少ない</label>
            </li>
          </ul>
        </div>

        <div class="question" id="SNS" style="display:none;">
          <div class="toi">活動しているSNSは??</div>

          <ul>
            <li>
              <input type="checkbox" id="YouTube" name="drone" value="YouTube" />
              <label for="YouTube">YouTube</label>
            </li>

            <li>
              <input type="checkbox" id="X" name="drone" value="X" />
              <label for="X">X</label>
            </li>

            <li>
              <input type="checkbox" id="Tiktok" name="drone" value="Tiktok" />
              <label for="Tiktok">Tiktok</label>
            </li>

            <li>
              <input type="checkbox" id="Instagram" name="drone" value="Instagram" />
              <label for="Instagram">Instagram</label>
            </li>

            <li>
              <input type="checkbox" id="Facebook" name="drone" value="Facebook" />
              <label for="Facebook">Facebook</label>
            </li>

            <li>
              <input type="checkbox" id="Twitch" name="drone" value="Twitch" />
              <label for="Twitch">Twitch</label>
            </li>
          </ul>
        </div>

        <div class="question" id="MMD" style="display:none;">
          <div class="toi">MMDは??</div>

          <ul>
            <li>
              <input type="checkbox" id="yes" name="drone" value="あり" />
              <label for="yes">あり</label>
            </li>

            <li>
              <input type="checkbox" id="no" name="drone" value="なし" />
              <label for="no">なし</label>
            </li>
          </ul>
        </div>

        <div class="question" id="卒業（配信活動終了）" style="display:none;">
          <div class="toi">卒業・配信活動終了??</div>

          <ul>
            <li>
              <input type="checkbox" id="y" name="drone" value="あり" />
              <label for="y">あり</label>
            </li>

            <li>
              <input type="checkbox" id="n" name="drone" value="なし" />
              <label for="n">なし</label>
            </li>
          </ul>
        </div>

        <div class="question" id="スタッフ" style="display:none;">
          <div class="toi">スタッフ??</div>

          <ul>
            <li>
              <input type="checkbox" id="e" name="drone" value="はい" />
              <label for="e">はい</label>
            </li>

            <li>
              <input type="checkbox" id="o" name="drone" value="いいえ" />
              <label for="o">いいえ</label>
            </li>
          </ul>
        </div>

      </div>

      <div class="NEXT" style="display: block;">
        <img src="推し活素材/画像/NEXT.png" width="250px">
      </div>
      <div class="Result" style="display: none;">
        <!-- <a href="result.html" class="result"> -->
        <img class="result" src="推し活素材/画像/RESULT.png" width="320px">
        <!-- </a> -->
      </div>
    </div>
  </div>

  <script>

    let holodata = null
    let count = 0;



    async function loadCSV() {
      try {
        const CSVdata = await fetch("推し活素材/holoform.csv");
        const text = await CSVdata.text();
        const data = text.trim().split('\n')
          .map(line => line.split(',').map(x => x.trim()));
        const keys = data[0];
        holodata = data.slice(1).map((item) => {
          let obj = {};
          keys.forEach((key, i) => (obj[key] = item[i]));
          return obj;
        });
      } catch (e) {
        console.error("CSV読み込み中にエラー:", e);
      }
    }


    let questionlist = ["系統", "イメージカラー", "けもみみ", "主に何を見たいか", "配信頻度", "SNS", "MMD", "卒業（配信活動終了）", "スタッフ"];
    let answerDict = {};

    function clickListener(e) {
      var questionId = document.getElementsByClassName('question')
      var elements = document.getElementById(questionlist[count])
      var inputs = elements.getElementsByTagName('input');
      console.log(inputs)
      var checkcount = 0
      var answerlist = [];
      for (var i = 0; i < inputs.length; i++) {
        console.log(inputs[i].checked)
        if (inputs[i].checked) {
          console.log(inputs[i].value);
          answerlist.push(inputs[i].value);

          checkcount++;

        }
      }
      if (checkcount == 0) {
        alert("選択肢を選んでください...")
        return
      }
      answerDict[questionlist[count]] = answerlist

      if (count == 7) {
        var NEXT = document.getElementsByClassName('NEXT')
        var NEXTelm = NEXT.item(0)
        NEXTelm.style.display = 'none'
        var Result = document.getElementsByClassName('Result')
        var Resultelm = Result.item(0)
        Resultelm.style.display = 'block'
        console.log(answerDict)

        // for (let key in answerDict) {
        //   alert('key:' + key + 'value:' + answerDict[key]);
        // }

      }

      if (questionId.length < count) return

      var elm = questionId.item(count)
      console.log(elm)
      console.log(elm)

      if (elm.style.display == 'block') {
        elm.style.display = 'none'
      }
      count += 1;
      console.log(count)
      var elm = questionId.item(count)

      if (elm.style.display == 'none') {
        elm.style.display = 'block'
      }

      // console.log(answerDict["けもみみ"]);

    }
    async function ResultListener() {
      var resultdict = {}
      await loadCSV();
      if (!holodata) {
        // alert("データを読み込んでいます。少々お待ちください。");
      }
      console.log(holodata[0])
      const resultlist = []
      for (let key in answerDict) {
        console.log('key:' + key + 'value:' + answerDict[key]);
        for (let holo of holodata) {
          if (answerDict[key].includes(holo[key])) {
            resultlist.push(holo)
            console.log("test")
          }
        }
      }
      for (var i = 0; i < resultlist.length; i++) {
        var elm = resultlist[i]["名前"];
        resultdict[elm] = (resultdict[elm] || 0) + 1;
        // console.log(elm,resultdict[elm])
      }
      console.log(JSON.stringify(resultdict));

      // alert([...resultlist])

      var array = Object.keys(resultdict).map((k) => ({ key: k, value: resultdict[k] }));
      array.sort((a, b) => a.value - b.value);
      console.log(array);
      var topthree = array.slice(-3);
      console.log(topthree);
      // alert(JSON.stringify(topthree))

      topnames = []
      for (let index in topthree) {
        console.log(topthree[index])
        name = topthree[index]["key"]

        resultlist.forEach(element => {
          if (element["名前"] == name) {
            console.log("PUSHED");
            topnames.push({
              "name": name,
              "url": element["URL"]
            })
          }
        });
      }
      const uniqueUsers = Array.from(
        new Map(topnames.map((user) => [user.name, user])).values()
      );
      // alert(JSON.stringify(topnames))

      sessionStorage.setItem("topnames", JSON.stringify(uniqueUsers));
      // let date = sessionStorage.getItem("key");
      // sessionStorage.removeItem("key");
      // sessionStorage.clear();

      location.href = "/result.html";
    }


    // function savechecklist(){
    //   var savelist = [],
    //   document.querySelectorAll('input[name="category"]:checked').forEach((checkbox)=>{
    //     savelist.push(checkbox.value);});
    //   }
    document.querySelector(".NEXT").addEventListener('click', clickListener)
    document.querySelector(".result").addEventListener('click', ResultListener)
  </script>
  <!-- <script src="script.js"></script> -->

  <audio id="click" src="推し活素材/効果音/クリック音.mp3"></audio>
  <audio id="bgm" src="推し活素材/効果音/BGM2.mp3"></audio>
  <script>
    function playclick() {
      let click = document.getElementById("click");
      click.src = "推し活素材/効果音/クリック音.mp3";
      click.play();
    }
    function playBGM() {
      let bgm = document.getElementById("bgm");
      bgm.src = "推し活素材/効果音/BGM2.mp3";
      bgm.play();
    }
    window.addEventListener("click", playclick);
    window.addEventListener("click", playBGM, { once: true });
  </script>
  <!-- <script>
    const holodata=[]
    async function loadCSV() {
      const CSVdata = await fetch("推し活素材/holoform.csv");
      const text = await CSVdata.text();
      // console.log(text)
      const data = text.trim().split('\n')
        .map(line => line.split(',').map(x => x.trim()));
      console.log(data)
      const keys = data[0];
      console.log(keys)
      const newData = data.slice(1).map((item) => {
        let obj = {};
        keys.forEach((key, i) => (obj[key] = item[i]));
        return obj;
      });
      console.log(newData);
      holodata=newData
      // const dataCSV = resCSV.trim().split(/\r\n|\n/).map(line => line.split(','));
      // const htmlData = dataCSV.map(data => `<tr><th>${data[0]}</th><td>${data[1]}</td><td>${data[2]}</td><td>${data[3]}</td><td>${data[4]}</td></tr>`).join('');
      // document.getElementById('tableCSV').insertAdjacentHTML('beforeend',htmlData);
    }
  </script> -->

</body>

</html>